<!doctype html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Shop-Single | Bookshop Responsive Bootstrap4 Template - SHARED ON THEMELOCK.COM</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicons -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/icon.png">

    <!-- Google font (font-family: 'Roboto', sans-serif; Poppins ; Satisfy) -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,500,600,600i,700,700i,800"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/plugins.css">
    <link rel="stylesheet" href="css/style.css">

    <!-- Cusom css -->
    <link rel="stylesheet" href="css/custom.css">

    <!-- Modernizer js -->
    <script src="js/modernizr-3.5.0.min.js"></script>
    <style>
        ul.pagination {
            display: inline-block;
            padding: 0;
            margin: 0;
        }

        ul.pagination li {
            display: inline;
        }

        ul.pagination li a {
            color: black;
            float: left;
            padding: 8px 16px;
            text-decoration: none;
        }
    </style>
</head>
<body>
<!--[if lte IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade
    your browser</a> to improve your experience and security.</p>
<![endif]-->

<!-- Main wrapper -->
<div class="wrapper" id="wrapper">

    <!-- Header -->
    <header id="wn__header" class="oth-page header__area header__absolute sticky__header">

    </header>
    <!-- //Header -->
    <div id="wn_search" class="brown--color box-search-content search_active block-bg close__top">
        <form id="search_mini_form" class="minisearch" action="#">
            <div class="field__search">
                <input id="search_word" type="text" placeholder="Search entire store here...">
                <div class="action">
                    <a id="search_btn"><i class="zmdi zmdi-search"></i></a>
                </div>
            </div>
        </form>
        <div class="close__wrap">
            <span>close</span>
        </div>
    </div>
    <!-- Start Bradcaump area -->
    <div class="ht__bradcaump__area bg-image--4">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="bradcaump__inner text-center">
                        <h2 class="bradcaump-title">图书详情</h2>
                        <nav class="bradcaump-content">
                            <a class="breadcrumb_item" href="index.html">首页</a>
                            <span class="brd-separetor">/</span>
                            <span class="breadcrumb_item active">图书详情</span>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Bradcaump area -->
    <!-- Start main Content -->
    <div class="maincontent bg--white pt--80 pb--55">
        <div class="container">
            <div class="row">
                <div class="col-lg-9 col-12">
                    <div class="wn__single__product">
                        <div class="row">
                            <!--轮播图-->
                            <div class="col-lg-6 col-12">
                                <div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
                                    <div class="carousel-inner" id="imgs">
                                        <div class="carousel-item active">
                                            <img src="images/product/1.jpg" class="d-block w-100" alt="...">
                                        </div>
                                        <div class="carousel-item">
                                            <img src="images/product/1.jpg" class="d-block w-100" alt="...">
                                        </div>
                                        <div class="carousel-item">
                                            <img src="images/product/1.jpg" class="d-block w-100" alt="...">
                                        </div>
                                    </div>
                                    <a class="carousel-control-prev" href="#carouselExampleFade" role="button"
                                       data-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                    <a class="carousel-control-next" href="#carouselExampleFade" role="button"
                                       data-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </div>
                            </div>
                            <!--书籍信息-->
                            <div class="col-lg-6 col-12">
                                <div class="product__info__main">
                                    <h1 id="bookName">《书名》</h1>
                                    <div class="product-info-stock-sku d-flex">
                                        <p>发布者：<span id="publisher"> In stock</span></p>
                                        <p>已发布：<span><a id="pulishCount"> x件 </a></span></p>

                                    </div>
                                    <div class="product-info-stock-sku d-flex">
                                        <p>邮箱：<span><a id="email">*********@**.com</a></span></p>
                                        <p>电话：<span><a id="phone">1**********</a></span></p>
                                    </div>
                                    <div class="price-box">
                                        <span id="price">xxx元</span>
                                    </div>
                                    <div class="box-tocart d-flex">
                                        <div class="addtocart__actions">
                                            <button onclick="addFav();" id="add_fav" class="tocart" type="button">添加收藏
                                            </button>
                                        </div>
                                        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        <span id="fav_count">已被收藏x次</span>
                                    </div>
                                    <div class="product__overview">
                                        <p id="introduce">我是简介</p>
                                    </div>
                                </div>
                            </div>
                            <!--评论-->
                            <div class="col-lg-12">
                                <div class="col-lg-12 row">
                                    <div class="col-lg-10">
                                        <textarea rows="5" cols="100" id="comment"></textarea>
                                    </div>
                                    <div class="col-lg-2">
                                        <button style="width: 120px;height: 126px" onclick="addComment(bookId);">发表评论
                                        </button>
                                    </div>
                                </div>
                                <br>
                                <div class="col-lg-12" id="comment_reply">
                                    <div>
                                        <hr>
                                        <hr>
                                        <hr>
                                        <hr>
                                        <hr>
                                        <hr>
                                        <div class="float-left">用户：qwer。 评论时间：2021-04-22 16:30</div>
                                        <br>
                                        <div class="float-none"><p style="font-size: 25px">
                                            评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容</p></div>
                                        <div hidden><input type="text" size="60">&nbsp;&nbsp;&nbsp;<button
                                                type="button">提交
                                        </button>
                                        </div>
                                        <div class="float-right"><a href="javascript:void(0);">评论</a></div>
                                        <br>
                                        <div>
                                            <hr>
                                            <hr>
                                            <div class="float-left">用户：abcd 回复。 回复时间：2021-04-23 08:22</div>
                                            <br>
                                            <div class="float-none"><p style="font-size: 15px">
                                                评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容</p></div>
                                            <div hidden><input type="text" size="60">&nbsp;&nbsp;&nbsp;<button
                                                    type="button">提交
                                            </button>
                                            </div>
                                            <div class="float-right"><a href="javascript:void(0);">回复</a></div>
                                            <br>
                                        </div>
                                        <div>
                                            <hr>
                                            <hr>
                                            <div class="float-left">用户：abcd 回复。 回复时间：2021-04-23 08:22</div>
                                            <br>
                                            <div class="float-none"><p style="font-size: 15px">
                                                评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容</p></div>
                                            <div hidden><input type="text" size="60">&nbsp;&nbsp;&nbsp;<button
                                                    type="button">提交
                                            </button>
                                            </div>
                                            <div class="float-right"><a href="javascript:void(0);">回复</a></div>
                                            <br>
                                        </div>
                                    </div>
                                    <ul class="pagination">
                                        <li><a href="#">«</a></li>
                                        <li><a href="#">1</a></li>
                                        <li><a class="active" href="#">2</a></li>
                                        <li><a href="#">3</a></li>
                                        <li><a href="#">4</a></li>
                                        <li><a href="#">5</a></li>
                                        <li><a href="#">6</a></li>
                                        <li><a href="#">7</a></li>
                                        <li><a href="#">»</a></li>
                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-12 md-mt-40 sm-mt-40">
                    <div class="shop__sidebar">
                        <aside class="wedget__categories poroduct--cat">
                            <h3 class="wedget__title">学院分类</h3>
                            <ul id="side_major">

                            </ul>
                        </aside>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End main Content -->
    <!-- Footer Area -->
    <footer id="wn__footer" class="footer__area bg__cat--8 brown--color">
    </footer>        <!-- //Footer Area -->


</div>
<!-- //Main wrapper -->


<!-- JS Files -->
<script src="js/jquery-3.3.1.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/plugins.js"></script>
<script src="js/active.js"></script>
<script type="text/javascript" src="js/include.js"></script>
<script src="js/getParameter.js"></script>
<script>
    var bookId = getParameter("id");
    $(function () {
        $("#search_btn").click(function () {
            var sname = $("#search_word").val();
            var mid = getParameter("mid");
            location.href = "/GraduationProject/book-list.html?mid=" + mid + "&sname=" + sname;
        });
        $.get("user/getUsername.do", function (data) {
            if (data.username != null) {
                $.get("favorite/isFav.do", {bid: bookId, uid: data.id}, function (data) {
                    if (data == true) {
                        $("#add_fav").attr("disabled", "disabled");
                        $("#add_fav").text("已收藏");
                    }
                })
            }
            $.get("favorite/getFavCount.do", {bid: bookId}, function (data) {
                $("#fav_count").text("已被收藏 " + data + " 次");
            })
        });
        $.get("books/findById.do", {id: bookId}, function (data) {
            var imgLis = '<div class="carousel-item active">\n' +
                '<img src="' + data.img + '" class="d-block w-100" alt="...">\n' +
                '</div>';
            for (var i = 0; i < data.imgs.length; i++) {
                if (i == 0) {
                    var imgLi = '<div class="carousel-item active">\n' +
                        '<img src="' + data.imgs[i].img + '" class="d-block w-100" alt="...">\n' +
                        '</div>';
                } else {
                    var imgLi = '<div class="carousel-item">\n' +
                        '<img src="' + data.imgs[i].img + '" class="d-block w-100" alt="...">\n' +
                        '</div>';
                }

                imgLis += imgLi;
            }
            $("#imgs").html(imgLis);
            $("#bookName").html('《' + data.name + '》');
            $("#publisher").html(data.user.username);
            $("#pulishCount").html(data.user.sellCount);
            $("#email").html(data.user.email);
            $("#phone").html(data.user.phoneNum);
            $("#price").html(data.price + '元');
            $("#introduce").html(data.introduce);
        });
        $.get("major/findAll.do", function (data) {
            // <li><a href="shop-grid.html">计算机科学与信息工程学院</a></li>
            var lis = "";
            for (var i = 0; i < data.length; i++) {
                var li = '<li><a href="book-list.html?mid=' + data[i].id + '">' + data[i].name + '</a></li>';
                lis += li;
            }
            $("#side_major").html(lis);
        });
        getComment();
    });

    function addFav() {
        var bid = getParameter("id");
        $.get("user/getUsername.do", function (data) {
            if (data.username != null) {
                $.get("favorite/addFav.do", {bid: bid, uid: data.id}, function (data) {
                    if (data) {
                        location.reload();
                    } else {
                        alert("添加失败")
                    }
                })
            } else {
                alert("请登录账号");
            }
        })
    }

    function displyReply(id) {
        if ($("#" + id).attr("hidden") == "hidden") {
            $("#" + id).removeAttr("hidden");
        } else {
            $("#" + id).attr("hidden", "hidden");
        }
    }

    function addReply(comment_id,replyed_id,reply_input) {
        $.get("user/getUsername.do", function (data) {
            if (data.username != null) {
                var content = $("#"+reply_input).val();
                $.post("comment/addReply.do", {comment_id: comment_id, uid: data.id,content:content,replyed_id:replyed_id}
                , function (flag) {
                    if (flag){
                        alert("回复成功");
                        $("#"+reply_input).val("");
                        getComment();
                    }else {
                        alert("回复失败");
                    }
                })
            } else {
                alert("请登录账号");
            }
        })
    }

    function getComment() {
        $.get("comment/findComment.do", {bid: bookId}, function (data) {
            var comLis = '';
            for (var i = 0; i < data.length; i++) {
                var comment = data[i];
                var comLi = '<div>\n' +
                    '                                        <hr color="#000000"><hr color="#000000"><hr color="#000000"><hr color="#000000"><hr color="#000000"><hr color="#000000">\n' +
                    '                                        <div class="float-left">用户：' + comment.username + ' 评论。 评论时间：' + comment.comment_time + '</div><br>\n' +
                    '                                        <div class="float-none"><p style="font-size: 25px">' + comment.content + '</p></div>\n' +
                    '                                        <div hidden="hidden" id="comment' + comment.comment_id + '"><input type="text" id="comment_input'+comment.comment_id+'" size="60">&nbsp;&nbsp;&nbsp;<button type="button" onclick="addReply(' + comment.comment_id + ','+comment.uid+',\'comment_input'+comment.comment_id+'\')">提交</button></div>\n' +
                    '                                        <div class="float-right"><a href="javascript:void(0);" onclick="displyReply(\'comment' + comment.comment_id + '\')">评论</a></div><br>\n';
                var replies = comment.comment_replies;
                for (var j = 0; j < replies.length; j++) {
                    var reply = replies[j];
                    comLi += '<div>\n' +
                        '                                            <hr><hr>\n' +
                        '                                            <div class="float-left">用户：' + reply.username + '回复'+reply.replyed_name+'。 回复时间：' + reply.reply_time + '</div><br>\n' +
                        '                                            <div class="float-none"><p style="font-size: 15px">' + reply.content + '</p></div>\n' +
                        '                                            <div hidden="hidden" id="reply' + reply.reply_id + '"><input type="text" size="60" id="reply_input'+reply.reply_id+'">&nbsp;&nbsp;&nbsp;<button type="button" onclick="addReply(' + comment.comment_id + ','+reply.uid+',\'reply_input'+reply.reply_id+'\')">提交</button></div>\n' +
                        '                                            <div class="float-right"><a href="javascript:void(0);"  onclick="displyReply(\'reply' + reply.reply_id + '\')">回复</a></div><br>\n' +
                        '                                        </div>';
                }
                comLi += '</div>';
                comLis += comLi;
            }
            $("#comment_reply").html(comLis);
        })
    }
    function addComment(bid) {
        $.get("user/getUsername.do", function (data) {
            if (data.username != null) {
                var content = $("#comment").val();
                $.post("comment/addComment.do", {bid: bid, uid: data.id,content:content}, function (flag) {
                    if (flag){
                        alert("评论成功");
                        $("#comment").val("");
                        getComment();
                    }else {
                        alert("评论失败");
                    }
                })
            } else {
                alert("请登录账号");
            }
        })
    }
</script>


</body>
</html>